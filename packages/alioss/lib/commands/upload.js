!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";const e=require("fs-extra"),s=require("ignore"),r=require("path"),t=require("ali-oss"),i=require("chalk"),{AES_decrypted:o}=require("../utils/aes.crypto"),c=/\\\\|\\/g,n={description:"alioss 上传",async apply(){console.time("上传时间：");const n=r.resolve(process.cwd(),"alioss.config.js"),a=require(n),l=r.resolve(process.cwd(),a.localDir),u=function(s){const t=[];function i(s){e.readdirSync(s,{withFileTypes:!0}).forEach((e=>{const o=r.resolve(s,e.name);e.isFile()?t.push(r.relative(process.cwd(),o)):e.isDirectory()&&i(o)}))}return i(s),t}(l),d=function(){const s=r.resolve(process.cwd(),".ossignore");e.ensureFileSync(s);return e.readFileSync(s,"utf8").trim().split("\n").filter((function(e){return e?!/^#\s?/.test(e):!!e}))}(),f=s().add(d).filter(u),{key:p,iv:y}=a,{region:g,accessKeyId:h,accessKeySecret:w,bucket:m}=a.aliossOptions,v=new t({...a.aliossOptions,region:o(g,p,y),accessKeyId:o(h,p,y),accessKeySecret:o(w,p,y),bucket:o(m,p,y)}),q=(S=v,{async isExistObject(e,s={}){try{return await S.head(e,s),!0}catch(e){if("NoSuchKey"===(null==e?void 0:e.code))return!1;throw new Error(e)}}});var S;for(const e of function(e,s=20){const r=Math.ceil(e.length/s);return Array.from({length:r},((r,t)=>e.slice(t*s,(t+1)*s)))}(f,40))await Promise.all(e.map((async e=>{const s=r.join(a.remoteDir,r.relative(l,e)).replace(c,"/");if(await q.isExistObject(s))console.log(i.green(`${e} 文件已存在`));else{const{res:t}=await v.put(s,r.normalize(e));console.log(i[200===t.status?"green":"red"](`${e} to oss ${s} ${t.statusMessage}`))}})));console.timeEnd("上传时间：")}};module.exports=n}));
